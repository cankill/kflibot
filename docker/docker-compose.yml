version: '3.9'
services:
  filibustier:
    build:
      context: filibustier
      dockerfile: Dockerfile
    container_name: filibustier
    init: true
    tty: true
    stdin_open: true
    environment:
      - DB_HOST=maria-db
      - DB_PORT
      - PROXY_HOST=proxy
      - PROXY_PORT
      - TELEGRAM_BOT_AUTH_KEY=6862350364:AAG0PDcjuKOgoB6izBNBysaQUNKII8x-QuQ
    depends_on:
      maria-db:
        condition: service_healthy
      proxy:
        condition: service_healthy

  maria-db:
    build:
      context: maria-db
      dockerfile: Dockerfile
    container_name: maria-db
    init: true
    tty: true
    stdin_open: true
#    ports:
#      - 3306:3306
#    command: ./download.sh
    environment:
      - MARIADB_ROOT_PASSWORD=rootPassword
      - MARIADB_DATABASE=flibot
      - MARIADB_USER=sysadm
      - MARIADB_PASSWORD=password_to_change
    healthcheck:
      test: [ "CMD", "mariadb-admin" ,"ping", "-h", "localhost" ]
      timeout: 20s
      retries: 10

  proxy:
      image: osminogin/tor-simple
      container_name: proxy
      restart: always
      stdin_open: true
#      ports:
#        - 9050:9050

#      depends_on:
#        - nginx

#  nginx:
#    image: nginx
#    restart: always
##    links:
##      - drupal:drupalhost
#    volumes:
#      - nginx/nginx.conf:/etc/nginx/nginx.conf:ro
